<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sujie.modules.clean.dao.OrderDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.sujie.modules.clean.entity.OrderEntity" id="orderMap">
        <result property="id" column="id"/>
        <result property="orderId" column="order_id"/>
        <result property="homestayId" column="homestay_id"/>
        <result property="roomId" column="room_id"/>
        <result property="cleanType" column="clean_type"/>
        <result property="preCleanDate" column="pre_clean_date"/>
        <result property="cleanPrice" column="clean_price"/>
        <result property="isCheckOut" column="is_check_out"/>
        <result property="checkOutDate" column="check_out_date"/>
        <result property="cleanStatusCode" column="clean_status_code"/>
        <result property="createDate" column="create_date"/>
    </resultMap>
    <select id="listPreOrder" resultType="java.util.Map">
        SELECT
        -- a.id id,
        -- a.homestay_name homestayName,
        a.homestay_address homestayAddress,
        count( 1 ) count
        FROM
        homestay.order t
        INNER JOIN homestay.homestay_info a ON t.homestay_id = a.homestay_id
        WHERE
        1 = 1
            AND t.clean_status_code = 0
        GROUP BY
        -- a.id,
        -- a.homestay_name,
        a.homestay_address
    </select>

    <select id="listPreOrderDetail" resultType="java.util.Map">
        SELECT
        a.id id,
        a.homestay_name homestayName,
        a.homestay_address homestayAddress,
        count( 1 ) count
        FROM homestay.order t
        INNER JOIN homestay.homestay_info a ON t.homestay_id = a.homestay_id
        WHERE
        1 = 1
            AND t.clean_status_code = 0
        AND a.homestay_address = #{homestayAddress}
        GROUP BY
        a.id,
        a.homestay_name,
        a.homestay_address
    </select>
    <select id="getPreparOrderCount" resultType="java.lang.Integer">
        SELECT
        count( 1 ) total
        FROM
        homestay.order t
        INNER JOIN homestay.homestay_info a ON t.homestay_id = a.homestay_id
        WHERE
        1 = 1
            AND t.clean_status_code = 0

    </select>
    <select id="listOrderVO" resultType="com.sujie.modules.clean.vo.OrderVO">
        SELECT
        t.id,
        c.actual_clean_date,
        a.homestay_name,
        a.homestay_address,
        b.room_id,
        d.item_name roomType,
        c.staff_cost,
        e.staff_name,
        d.comments ,
        c.is_first,
        c.boss_cost,
        t.pre_clean_date,
        f.item_name
        FROM
        homestay.ORDER t
        JOIN homestay.homestay_info a ON t.homestay_id = a.id
        JOIN homestay.room_info b ON t.room_id = b.id
        JOIN homestay.order_record c ON t.order_id = c.order_id
        JOIN homestay.dict_room_type d ON b.room_type = d.item_code
        JOIN homestay.staff_info e ON c.staff_id = e.staff_id
        JOIN homestay.dict_order_status f ON c.status = f.item_code
        WHERE
        1 = 1
        <if test="params.cleanStatusCode!=null and params.cleanStatusCode !='' ">
            AND t.clean_status_code = #{params.cleanStatusCode}
        </if>

        <if test="params.homestayName!=null and params.homestayName!=''">
            AND a.homestay_name like CONCAT('%',#{params.homestayName},'%')
        </if>
        <if test="params.roomId!=null and params.roomId!='' ">
            And b.room_id like CONCAT('%',#{params.roomId},'%')
        </if>
        <if test="params.homestayAddress!=null and params.homestayAddress!='' ">
            AND a.homestay_address like CONCAT('%',#{params.homestayAddress},'%')
        </if>
        <if test="params.actualCleanDate!=null and params.actualCleanDate!='' ">
            AND DATE_FORMAT(c.actual_clean_date,'%Y-%m-%d') = #{params.actualCleanDate}
        </if>

    </select>

</mapper>